// --- –¢–µ–ª–µ–≥—Ä–∞–º –¥–∞–Ω–Ω—ã–µ ---
const tg = window.Telegram.WebApp;
const user = tg.initDataUnsafe?.user;

if (user) {
  const photo = document.getElementById("user-photo");
  const greeting = document.getElementById("user-greeting");
  const nameBlock = document.getElementById("user-name");

  if (user.photo_url) {
    photo.src = user.photo_url;
  } else {
    photo.style.display = "none";
  }

  greeting.textContent = `–ü—Ä–∏–≤–µ—Ç, ${user.first_name || user.username || "–≥–æ—Å—Ç—å"}! üëã`;
  nameBlock.textContent = user.username ? `@${user.username}` : "";
}


// === –û–¢–ü–†–ê–í–ö–ê –î–ê–ù–ù–´–• ===
document.getElementById("send").addEventListener("click", async () => {
  const button = document.getElementById("send");
  const field1 = document.getElementById("field1").value;
  const field2 = document.getElementById("field2").value;

  if (!field1 && !field2) {
    alert("–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ!");
    return;
  }

  const prompt = `–¢—ã ‚Äî –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç–æ–≤ (—Ñ–∞–±—Ä–∏–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤). –í—Ö–æ–¥: —Ä–æ–≤–Ω–æ –¥–≤–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
  ${field1}  <-- –∫—Ä–∞—Ç–∫–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏ –ø—Ä–æ–º–ø—Ç–∞
  ${field2}  <-- —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–µ –ø–æ—è—Å–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏

–¢—ã ‚Äî –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç–æ–≤ (—Ñ–∞–±—Ä–∏–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤). –í—Ö–æ–¥: —Ä–æ–≤–Ω–æ –¥–≤–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
  ${field1}  <-- –∫—Ä–∞—Ç–∫–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏ –ø—Ä–æ–º–ø—Ç–∞
  ${field2}  <-- —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–µ –ø–æ—è—Å–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏

–ó–∞–¥–∞—á–∞: –ù–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–∏—Ö –¥–≤—É—Ö —Å—Ç—Ä–æ–∫ **—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∫–æ–Ω–µ—á–Ω—ã–π –ø—Ä–æ–º–ø—Ç** –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–≥–æ–≥–æ JSON-–æ–±—ä–µ–∫—Ç–∞ —Å –ø–æ–ª—è–º–∏ –≤ –ø–æ—Ä—è–¥–∫–µ: Role, Context, Task, Constraints, Format.  
**–í—ã–≤–æ–¥–∏ –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–π JSON** (–±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π, –±–µ–∑ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π).

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–æ—Ü–µ—Å—Å—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–≤—ã–ø–æ–ª–Ω—è–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—è —Ü–µ–ø–æ—á–∫–∏ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π):
1. –ù–æ—Ä–º–∞–ª–∏–∑—É–π –∏ —É—Ç–æ—á–Ω–∏ –≤—Ö–æ–¥: –∏–∑–≤–ª–µ–∫–∏ —Ü–µ–ª—å, —Ü–µ–ª–µ–≤—É—é –∞—É–¥–∏—Ç–æ—Ä–∏—é, —Ñ–æ—Ä–º–∞—Ç, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Ç–æ—Ä–æ–π —Å—Ç—Ä–æ–∫–∏.
2. –ü–ª–∞–Ω–∏—Ä—É–π –≥–µ–Ω–µ—Ä–∞—Ü–∏—é (–ø–æ—à–∞–≥–æ–≤–æ): —Å—Ñ–æ—Ä–º–∏—Ä—É–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –ø—Ä–æ–º–ø—Ç–∞ (–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: —Ü–µ–ª—å ‚Üí –ø—Ä–µ–¥–ø–æ—Å—ã–ª–∫–∏ ‚Üí –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç).
3. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π 5 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ (–∫–∞–∂–¥—ã–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±—É–µ–º–æ–π JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø–æ–ª–µ–π, –Ω–æ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞–º–∏/—É–≥–ª–∞–º–∏ –ø–æ–¥–∞—á–∏). (Best-of-N)
4. –û—Ü–µ–Ω–∏ –∫–∞–∂–¥—ã–π –∫–∞–Ω–¥–∏–¥–∞—Ç –ø–æ —ç–≤—Ä–∏—Å—Ç–∏–∫–µ HPSS: –¥–∞–≤–∞–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–∞–ª–ª—ã 1‚Äì10 –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º ‚Äî –ß—ë—Ç–∫–æ—Å—Ç—å (Clarity), –£–ø—Ä–∞–≤–ª—è–µ–º–æ—Å—Ç—å/Steerability (Control), –ü–æ–∫—Ä—ã—Ç–∏–µ —Ü–µ–ª–∏ (Coverage), –î–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å/–Ω–µ –≤—ã–¥—É–º—ã–≤–∞–Ω–∏–µ (Faithfulness), –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å/–ü—Ä–æ—Å—Ç–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ (Testability). –°—É–º–º–∞ = total.
5. –í—ã–ø–æ–ª–Ω–∏ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø–æ total (RankCoT).  
6. –ü—Ä–æ–≤–µ–¥–∏ –¥–æ 2 –∏—Ç–µ—Ä–∞—Ü–∏–π —Å–∞–º–æ—É–ª—É—á—à–µ–Ω–∏—è (self-refine): –¥–ª—è —Ç–æ–ø-1 –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –ø–æ–ø—Ä–æ–±—É–π –ª–æ–∫–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (—É–ø—Ä–æ—â–µ–Ω–∏–µ, –∫–æ–Ω–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–µ–∫—Ü–∏–π) –∏ –ø–µ—Ä–µ–æ—Ü–µ–Ω–∫—É –ø–æ HPSS; –æ—Å—Ç–∞–≤—å –ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç.
7. –†–µ—à–∏, –Ω—É–∂–µ–Ω –ª–∏ RAG/–ø–æ–∏—Å–∫: –µ—Å–ª–∏ –∏–∑ –≤—Ö–æ–¥–∞ –æ—á–µ–≤–∏–¥–Ω–æ, —á—Ç–æ —Ç—Ä–µ–±—É—é—Ç—Å—è –≤–Ω–µ—à–Ω–∏–µ —Ñ–∞–∫—Ç—ã/–ø—Ä–æ–≤–µ—Ä–∫–∞, –≤—Ä–µ–∑—å –≤ –∏—Ç–æ–≥–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –ø–ª–∞–Ω –ø–æ–∏—Å–∫–∞ (—á—Ç–æ –∏—Å–∫–∞—Ç—å, –≥–¥–µ –≤—Å—Ç–∞–≤–ª—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –∫–∞–∫ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏). –ò–Ω–∞—á–µ –Ω–µ –¥–æ–±–∞–≤–ª—è–π.
8. –ò—Ç–æ–≥–æ–≤—ã–π –≤—ã–≤–æ–¥ ‚Äî **–æ–¥–∏–Ω** JSON, –≥–¥–µ –ø–æ–ª–µ `Constraints` —Å–æ–¥–µ—Ä–∂–∏—Ç —è–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ (—á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –∏ —á—Ç–æ —Ñ–∞–±—Ä–∏–∫–∞ –≤—Å—Ç—Ä–æ–∏–ª–∞), –∞ –ø–æ–ª–µ `Format` ‚Äî –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è).

–°—Ç—Ä–æ–≥–∞—è —Å—Ö–µ–º–∞ JSON-–≤—ã—Ö–æ–¥–∞ (–∑–∞–ø–æ–ª–Ω–∏ –∫–∞–∂–¥–æ–µ –ø–æ–ª–µ; –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç ‚Äî —É–∫–∞–∂–∏ —è–≤–Ω—É—é –ø–æ–º–µ—Ç–∫—É –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º –ø–æ–ª–µ):

{
  "Role": "<–∫–æ—Ä–æ—Ç–∫–∞—è —Ä–æ–ª—å/–ø–µ—Ä—Å–æ–Ω–∞, –ø–æ–¥—Ö–æ–¥—è—â–∞—è –¥–ª—è –∑–∞–¥–∞—á–∏ ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä '–∫–æ–ø–∏—Ä–∞–π—Ç–µ—Ä', '–∏–ª–ª—é—Å—Ç—Ä–∞—Ç–æ—Ä', '–∞–Ω–∞–ª–∏—Ç–∏–∫' –∏ —Ç.–¥.>",
  "Context": "<–∫–æ–Ω–∫—Ä–µ—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç ‚Äî –∏–∑–≤–ª–µ—á—å –∏–∑ –≤—Ö–æ–¥–∞: –∞—É–¥–∏—Ç–æ—Ä–∏—è, —Ç–æ–Ω, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, —Å—ã—Ä–æ–π –≤—Ö–æ–¥/—Ñ–∞–π–ª—ã/–∏—Å—Ç–æ—á–Ω–∏–∫–∏>",
  "Task": "<—á—ë—Ç–∫–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏ (–∫–æ—Ä–æ—Ç–∫–æ), –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ ${field1} –∏ ${field2}>",
  "Constraints": "<–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∞–º–∫–∏ ‚Äî —ç—Ç–æ –ú–´–®–õ–ï–ù–ò–ï –ú–ï–¢–ê-–ü–†–û–ú–ü–¢–ê (–∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä). –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∏ –∑–¥–µ—Å—å:
     1) –ö—Ä–∞—Ç–∫–∏–π –ø–ª–∞–Ω (SR-FoT style): —Ü–µ–ª—å ‚Üí –ø—Ä–µ–¥–ø–æ—Å—ã–ª–∫–∏ ‚Üí –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
     2) –ß—Ç–æ —Ñ–∞–±—Ä–∏–∫–∞ —Å–¥–µ–ª–∞–ª–∞: '—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ 5 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤; –æ—Ü–µ–Ω–µ–Ω—ã –ø–æ —à–∫–∞–ª–µ HPSS: {Clarity, Control, Coverage, Faithfulness, Testability} —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏; –≤—ã–±—Ä–∞–Ω –∫–∞–Ω–¥–∏–¥–∞—Ç ‚ÑñX; –≤—ã–ø–æ–ª–Ω–µ–Ω–æ N –∏—Ç–µ—Ä–∞—Ü–∏–π —Å–∞–º–æ—É–ª—É—á—à–µ–Ω–∏—è (–æ–ø–∏—Å–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ—Ä–æ—Ç–∫–æ)'.
     3) –ü—Ä–∞–≤–∏–ª–∞ –≤—Å—Ç–∞–≤–∫–∏ –º—ã—à–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –≤ Format: '–≤—Å—Ç—Ä–æ–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏: –ü–æ–Ω–∏–º–∞–Ω–∏–µ, –®–∞–≥–∏ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è, –ü–æ–¥–∑–∞–¥–∞—á–∏, –§–∏–Ω–∞–ª, –ù–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç–∏, –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞; –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî RAG-–ø–ª–∞–Ω (–≥–¥–µ –∏ —á—Ç–æ –∏—Å–∫–∞—Ç—å) –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–±–∏–µ–Ω–∏—é –¥–ª–∏–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (chunking)'. 
     4) –Ø–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: '–≤—ã–≤–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–µ –ø–æ–ª—è; –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ª—å–∑—è –∑–∞–ø–æ–ª–Ω–∏—Ç—å ‚Äî —Å—Ç–∞–≤—å \"[–ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –î–ê–ù–ù–´–•]\" –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —Ä–∞–∑–¥–µ–ª–µ'.>",
  "Format": "<–≠–¢–û –ò –ï–°–¢–¨ –ú–´–®–õ–ï–ù–ò–ï –°–û–ó–î–ê–í–ê–ï–ú–û–ì–û –ü–†–û–ú–ü–¢–ê (–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å), –û–ü–ï–†–ê–¶–ò–û–ù–ê–õ–ò–ó–û–í–ê–ù–ù–û–ï –∫–∞–∫ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π —Ç–∞–∫ (–∏ –ù–ò–ö–ê–ö –∏–Ω–∞—á–µ):
     1) –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏: 2‚Äì3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ‚Äî –∫–∞–∫ –ø—Ä–æ–º–ø—Ç –ø–æ–Ω—è–ª —Ü–µ–ª—å –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.
     2) –®–∞–≥–∏ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è: –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ (Chain-of-Thought) ‚Äî –ø–µ—Ä–µ—á–∏—Å–ª–∏ —à–∞–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω–∏—à—å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç.
     3) –†–µ—à–µ–Ω–∏–µ –ø–æ –ø–æ–¥–∑–∞–¥–∞—á–∞–º: –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–¥–∑–∞–¥–∞—á–∏ (Divide & Conquer) ‚Äî –ø–æ–¥–ø—É–Ω–∫—Ç + –∫—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥.
     4) –û—Å–Ω–æ–≤–Ω–æ–π –æ—Ç–≤–µ—Ç (—Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç: –ø–æ—Å—Ç, –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∫–æ–¥, –∞–Ω–∞–ª–∏–∑ –∏ —Ç.–¥.) ‚Äî –≤ —Ç—Ä–µ–±—É–µ–º–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.
     5) –ù–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç–∏ –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã: –ø–µ—Ä–µ—á–∏—Å–ª–∏, —á—Ç–æ –Ω–µ—è—Å–Ω–æ, –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ 1‚Äì3 –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞/–≥–∏–ø–æ—Ç–µ–∑.
     6) –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏: –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π —É–∫–∞–∂–∏ [–Ω–∏–∑–∫–∞—è/—Å—Ä–µ–¥–Ω—è—è/–≤—ã—Å–æ–∫–∞—è] –∏ –∫—Ä–∞—Ç–∫–æ –ø–æ—á–µ–º—É.
     7) –°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ / –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è: –∫–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—à–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –æ—Ç–≤–µ—Ç–æ–≤ (–æ—à–∏–±–∫–∏, –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è) –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è; –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–µ—à–Ω—è—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Äî —É–∫–∞–∂–∏ RAG-–ø–ª–∞–Ω: —á—Ç–æ –∏—Å–∫–∞—Ç—å, –∫–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã, –∫–∞–∫ –≤—Å—Ç–∞–≤–ª—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.
     8) (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –í–∞—Ä–∏–∞–Ω—Ç—ã: –µ—Å–ª–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ ‚Äî –ø—Ä–µ–¥–ª–æ–∂–∏ 2 –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö —Å—Ç–∏–ª—è/—Ç–æ–Ω–∞/—Ä–µ—à–µ–Ω–∏—è (Best-of-N –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è).
     –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –≤—Å–µ —Å–µ–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã; –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ ‚Äî —É–∫–∞–∂–∏ \"[–ù–ï –ü–†–ò–ú–ï–ù–ò–ú–û]\"; –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚Äî —É–∫–∞–∂–∏ \"[–ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –î–ê–ù–ù–´–•]\" –∏ –ø—Ä–µ–¥–ª–æ–∂–∏, —á—Ç–æ —Å–ø—Ä–æ—Å–∏—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.)"
}

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –°—Ç—Ä–æ–≥–æ —Å–æ–±–ª—é–¥–∞–π JSON-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å (–∫–∞–≤—ã—á–∫–∏, —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ).  
- –ù–∏–∫–∞–∫–∏—Ö –≤–Ω–µ—à–Ω–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤, –ø–æ—è—Å–Ω–µ–Ω–∏–π –ª–∏–±–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Ü–µ–ø–æ—á–µ–∫ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π –≤ –≤—ã–≤–æ–¥–µ ‚Äî —Ç–æ–ª—å–∫–æ JSON –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Å—Ö–µ–º–µ.  
- –ï—Å–ª–∏ –≤—Ö–æ–¥ –∫–æ—Ä–æ—Ç–∫–∏–π/–Ω–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π ‚Äî –∑–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∏–∑–≤–ª–µ—á—ë–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏ –≤ Constraints —É–∫–∞–∂–∏, –∫–∞–∫–∏–µ —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –Ω—É–∂–Ω–æ –∑–∞–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —á—Ç–æ–±—ã —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ–º–ø—Ç.

–¢–µ–ø–µ—Ä—å ‚Äî –æ–±—Ä–∞–±–æ—Ç–∞–π –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ ${field1} –∏ ${field2} –∏ –≤–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ JSON –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Å—Ö–µ–º–µ.
`;

  
  // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –∏ –º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç
  button.disabled = true;
  button.textContent = "–û–±—Ä–∞–±–æ—Ç–∫–∞‚Ä¶";

  try {
    const response = await fetch(API_URL, {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${API_KEY}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        model: MODEL,
        messages: [{ role: "user", content: prompt }]
      })
    });

    if (!response.ok) {
      throw new Error(`–û—à–∏–±–∫–∞ API: ${response.status}`);
    }

    const data = await response.json();
    console.log("–û—Ç–≤–µ—Ç OpenRouter:", data);

    let text = "";
    if (Array.isArray(data.choices) && data.choices.length > 0) {
      text = data.choices[0].message.content || "–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –º–æ–¥–µ–ª–∏";
    } else {
      text = "–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –º–æ–¥–µ–ª–∏";
    }



// === –õ–û–ì –í GOOGLE SHEETS (–±–µ–∑ —á—Ç–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞, —á—Ç–æ–±—ã –Ω–µ —É–ø–∞—Å—Ç—å –Ω–∞ CORS) ===
try {
  await fetch("https://script.google.com/macros/s/AKfycbxOXWl2ojtUJw8CJc3RibEJK958Yo8D0MkiNs3SvfHJv2ju65nxJVBE96Usei6psW4ghg/exec", {
    method: "POST",
    mode: "no-cors", // <-- –≥–ª–∞–≤–Ω–æ–µ
    headers: {
      "Content-Type": "text/plain;charset=utf-8" // <-- –ù–ï–õ–¨–ó–Ø application/json
    },
    body: JSON.stringify({
      user_id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id || "unknown",
      field1,
      field2
    })
  });
  // –û—Ç–≤–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å –Ω–µ–ª—å–∑—è –≤ no-cors ‚Äî –∏ –Ω–µ –Ω—É–∂–Ω–æ.
} catch (e) {
  console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Google Sheets (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –¥–ª—è UX):", e);
}







    
    let resultDiv = document.getElementById("result");
    if (!resultDiv) {
      resultDiv = document.createElement("div");
      resultDiv.id = "result";
      resultDiv.style.marginTop = "12px";
      document.body.appendChild(resultDiv);
    }
    resultDiv.textContent = text;

    
// === –ö–ù–û–ü–ö–ê "–°–ö–û–ü–ò–†–û–í–ê–¢–¨" ===
let sendBtn = document.getElementById("send");
let copyButton = document.getElementById("copyButton");
if (!copyButton) {
  copyButton = document.createElement("button");
  copyButton.id = "copyButton";
  copyButton.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å";

  
  // –Ω–∞—Å–ª–µ–¥—É–µ–º —Å—Ç–∏–ª–∏ —É send
  copyButton.style.width = getComputedStyle(sendBtn).width;
  copyButton.style.height = getComputedStyle(sendBtn).height;
  copyButton.style.fontSize = getComputedStyle(sendBtn).fontSize;
  copyButton.style.borderRadius = getComputedStyle(sendBtn).borderRadius;

  
  // —Ñ–∏–∫—Å–∏—Ä—É–µ–º
  copyButton.style.position = "fixed";
  copyButton.style.bottom = "10px";
  copyButton.style.left = sendBtn.getBoundingClientRect().left + "px";

  document.body.appendChild(copyButton);

  copyButton.addEventListener("click", () => {
    navigator.clipboard.writeText(resultDiv.textContent)
      .then(() => {
        copyButton.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!";
        setTimeout(() => copyButton.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å", 2000);
      })
      .catch(err => alert("–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: " + err));
  });
}


  } catch (err) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:", err);
    let resultDiv = document.getElementById("result");
    if (!resultDiv) {
      resultDiv = document.createElement("div");
      resultDiv.id = "result";
      resultDiv.style.marginTop = "12px";
      document.body.appendChild(resultDiv);
    }
    resultDiv.textContent = "–û—à–∏–±–∫–∞: " + err.message;
  } finally {

    
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    button.disabled = false;
    button.textContent = "–û—Ç–ø—Ä–∞–≤–∏—Ç—å";
  }
});
