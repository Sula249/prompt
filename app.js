// --- –¢–µ–ª–µ–≥—Ä–∞–º –¥–∞–Ω–Ω—ã–µ ---
const tg = window.Telegram.WebApp;
const user = tg.initDataUnsafe?.user;

if (user) {
  const photo = document.getElementById("user-photo");
  const greeting = document.getElementById("user-greeting");
  const nameBlock = document.getElementById("user-name");

  if (user.photo_url) {
    photo.src = user.photo_url;
  } else {
    photo.style.display = "none";
  }

  greeting.textContent = `–ü—Ä–∏–≤–µ—Ç, ${user.first_name || user.username || "–≥–æ—Å—Ç—å"}! üëã`;
  nameBlock.textContent = user.username ? `@${user.username}` : "";
}


// === –û–¢–ü–†–ê–í–ö–ê –î–ê–ù–ù–´–• ===
document.getElementById("send").addEventListener("click", async () => {
  const button = document.getElementById("send");
  const field1 = document.getElementById("field1").value;
  const field2 = document.getElementById("field2").value;

  if (!field1 && !field2) {
    alert("–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ!");
    return;
  }

  const prompt = `–†–æ–ª—å:
–¢—ã ‚Äî —Ñ–∞–±—Ä–∏–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤. –ù–∞ –≤—Ö–æ–¥–µ –ø–æ–ª—É—á–∞–µ—à—å —Ä–æ–≤–Ω–æ –¥–≤–∞ –ø–æ–ª—è: ${field1} (–∫–æ—Ä–æ—Ç–∫–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ —Ü–µ–ª–∏) –∏ ${field2} (–ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ). –†–∞–±–æ—Ç–∞–π –º–Ω–æ–≥–æ—à–∞–≥–æ–≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –æ—Ü–µ–Ω–∫–∞, –¥–æ—Ä–∞–±–æ—Ç–∫–∞), –Ω–æ –≤—ã–≤–æ–¥–∏ –¢–û–õ–¨–ö–û –û–î–ò–ù –≤–∞–ª–∏–¥–Ω—ã–π JSON-–æ–±—ä–µ–∫—Ç ‚Äî –ª–∏–±–æ {"final_prompt":"..."} –ª–∏–±–æ {"clarifying_questions":["..."]}.

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
1. –ï—Å–ª–∏ ${field1} –ø—É—Å—Ç–æ –∏–ª–∏ —Å–æ—Å—Ç–æ–∏—Ç —Ç–æ–ª—å–∫–æ –∏–∑ –ø—Ä–æ–±–µ–ª–æ–≤ ‚Üí –≤–µ—Ä–Ω—É—Ç—å {"clarifying_questions":["–£—Ç–æ—á–Ω–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫–æ—Ä–æ—Ç–∫–æ —Ü–µ–ª—å (–æ–¥–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ)."]}.
2. –ï—Å–ª–∏ ${field2} –ø—É—Å—Ç–æ –∏–ª–∏ —Å–æ—Å—Ç–æ–∏—Ç —Ç–æ–ª—å–∫–æ –∏–∑ –ø—Ä–æ–±–µ–ª–æ–≤ ‚Üí –≤–µ—Ä–Ω—É—Ç—å {"clarifying_questions":["–î–∞–π, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ (–∫–æ–Ω—Ç–µ–∫—Å—Ç, –∞—É–¥–∏—Ç–æ—Ä–∏—è, –∂–µ–ª–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç)."]}.
(–¢–æ–ª—å–∫–æ —ç—Ç–∏ –¥–≤–∞ –ø–æ–ª—è ‚Äî –¥—Ä—É–≥–∏—Ö —É—Ç–æ—á–Ω—è—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å).

–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–æ–ª–µ–π (—Ç–∏—Ö–∏–π –ø–∞—Ä—Å–∏–Ω–≥):
‚Äî goal := trimmed(${field1}).
‚Äî input_data := trimmed(${field2}).
‚Äî –ü–æ–ø—ã—Ç–∞–π—Å—è –∏–∑–≤–ª–µ—á—å –∏–∑ input_data —è–≤–Ω–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ (–µ—Å–ª–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–∞–∫ —è–≤–Ω—ã–π –º–∞—Ä–∫–µ—Ä –∏–ª–∏ –æ—á–µ–≤–∏–¥–Ω–∞—è —Ñ—Ä–∞–∑–∞):
    audience, style_tone, length, must_include, must_avoid, constraints, output_format, domain.
  –ï—Å–ª–∏ —Å–≤–æ–π—Å—Ç–≤–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —è–≤–Ω–æ ‚Äî –æ—Å—Ç–∞–≤—å –µ–≥–æ –ø—É—Å—Ç—ã–º/–Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º (–Ω–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π).

–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ task_type (—Ç–∏—Ö–æ):
‚Äî –ï—Å–ª–∏ –≤ goal –∏–ª–∏ input_data —è–≤–Ω–æ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è —Å–ª–æ–≤–∞/–∫–æ—Ä–Ω–∏: "–∫–∞—Ä—Ç–∏–Ω", "–∏–∑–æ–±—Ä–∞–∂", "—Ä–∏—Å—É–Ω–æ–∫" ‚Üí image_generation.
‚Äî –ï—Å–ª–∏ "–∫–æ–¥", "—Å–∫—Ä–∏–ø—Ç", "—Ñ—É–Ω–∫—Ü", "api" ‚Üí code.
‚Äî –ï—Å–ª–∏ "—Ç–∞–±–ª–∏—Ü", "–∞–Ω–∞–ª–∏–∑", "trend", "–¥–∞–Ω–Ω" ‚Üí data_analysis.
‚Äî –ï—Å–ª–∏ "–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫", "–∏—Å—Ç–æ—á–Ω", "—Å—Å—ã–ª–∫–∞", "—Ñ–∞–∫—Ç" ‚Üí rag.
‚Äî –ò–Ω–∞—á–µ ‚Üí text_generation.

–¢–∏—Ö–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º (–Ω–µ –≤—ã–≤–æ–¥–∏—Ç—å —ç—Ç–∞–ø—ã):
1) –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ (–≤–∞—Ä–∏–∞–Ω—Ç—ã —Å—Ç–µ–ø–µ–Ω–∏ —è–≤–Ω–æ—Å—Ç–∏ –∏ —Ñ–æ—Ä–º–∞—Ç–∞).
2) –û—Ü–µ–Ω–∏—Ç—å –∏—Ö –≤–Ω—É—Ç—Ä–∏ –ø–æ —è—Å–Ω–æ—Å—Ç–∏/–ø–æ–ª–Ω–æ—Ç–µ/—É–ø—Ä–∞–≤–ª—è–µ–º–æ—Å—Ç–∏/—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏.
3) –í—ã–±—Ä–∞—Ç—å –ª—É—á—à–∏–π –∏ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å, —á—Ç–æ–±—ã: –≤—Å–µ —è–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —É—á—Ç–µ–Ω—ã; —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –±—ã–ª –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º –∏ –≤–∫–ª—é—á–∞–ª –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è.
4) –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã final_prompt: –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ ‚â§ 450 —Å–ª–æ–≤.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ final_prompt (—Å—Ç—Ä–æ–≥–æ):  
‚Äî –Ø–∑—ã–∫: –µ—Å–ª–∏ –≤ –≤—Ö–æ–¥–µ —è–≤–Ω–æ —É–∫–∞–∑–∞–Ω —è–∑—ã–∫ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ; –∏–Ω–∞—á–µ ‚Äî —è–∑—ã–∫ input_data (–µ—Å–ª–∏ –µ–≥–æ –º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å); –∏–Ω–∞—á–µ ‚Äî —Ä—É—Å—Å–∫–∏–π.  
‚Äî final_prompt –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
   ‚Ä¢ —Ä–æ–ª—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (–∫–æ—Ä–æ—Ç–∫–æ),
   ‚Ä¢ —Ñ–æ—Ä–º–∞–ª—å–Ω—É—é –∑–∞–¥–∞—á—É (goal),
   ‚Ä¢ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (—á–∞—Å—Ç—å input_data ‚Äî —Å–∂–∞—Ç–æ),
   ‚Ä¢ —è–≤–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è / must_include / must_avoid (–µ—Å–ª–∏ –µ—Å—Ç—å),
   ‚Ä¢ —á—ë—Ç–∫—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é: ¬´–≤—ã–ø–æ–ª–Ω—è–π –∑–∞–¥–∞—á—É —Å—Ç—Ä–æ–≥–æ –ø–æ —Å–ª–µ–¥—É—é—â–µ–º—É —Ñ–æ—Ä–º–∞—Ç—É –≤—ã–≤–æ–¥–∞; –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫ —Ñ–∏–Ω–∞–ª—É, –ø–æ–∫–∞ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã —Å–µ–∫—Ü–∏–∏ 1‚Äì3¬ª,
   ‚Ä¢ **–≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ (—Ñ–æ—Ä–º–∞—Ç –≤–Ω—É—Ç—Ä–∏ final_prompt)** ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —ç—Ç–∏ —Å–µ–∫—Ü–∏–∏, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:

    [1] –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ ‚Äî 1‚Äì3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è: –∫–∞–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –ø–æ–Ω—è–ª —Ü–µ–ª—å –∏ –∫–ª—é—á–µ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.  
    [2] –ü–ª–∞–Ω —Ä–µ—à–µ–Ω–∏—è ‚Äî –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —à–∞–≥–æ–≤ (—á—Ç–æ —Å–¥–µ–ª–∞–µ—à—å).  
    [3] –†–µ—à–µ–Ω–∏–µ –ø–æ –ø–æ–¥–∑–∞–¥–∞—á–∞–º ‚Äî –∑–∞–≥–æ–ª–æ–≤–∫–∏ ¬´–ü–æ–¥–∑–∞–¥–∞—á–∞ ‚Üí —Ö–æ–¥ ‚Üí –∫—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥¬ª –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–¥–∑–∞–¥–∞—á–∏.  
    [4] –û—Å–Ω–æ–≤–Ω–æ–π –æ—Ç–≤–µ—Ç ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ç—Ä–µ–±—É–µ–º–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (—Ç–µ–∫—Å—Ç/–∫–æ–¥/JSON/–æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è).  
    [5] –ù–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç–∏ –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã ‚Äî —á–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –∏ 1‚Äì2 —Ä–∞–∑—É–º–Ω—ã–µ –æ–ø—Ü–∏–∏.  
    [6] –£—Ä–æ–≤–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ ‚Äî –Ω–∏–∑–∫–∞—è/—Å—Ä–µ–¥–Ω—è—è/–≤—ã—Å–æ–∫–∞—è –ø–æ –∫–ª—é—á–µ–≤—ã–º –ø—É–Ω–∫—Ç–∞–º —Å –∫—Ä–∞—Ç–∫–∏–º –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º.

‚Äî –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ task_type (–≤—Å—Ç–∞–≤–ª—è–π –ª–∞–∫–æ–Ω–∏—á–Ω–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è):
   ‚Ä¢ image_generation: –∫—Ä–∞—Ç–∫–æ —É–∫–∞–∂–∏ —Å—é–∂–µ—Ç, –æ–±—ä–µ–∫—Ç—ã, –∫–æ–º–ø–æ–∑–∏—Ü–∏—é, —Å—Ç–∏–ª—å, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã; –¥–æ–±–∞–≤—å –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã.  
   ‚Ä¢ data_analysis: —É–∫–∞–∂–∏ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ/–æ–∂–∏–¥–∞–µ–º—ã–π –º–µ—Ç–æ–¥/–ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∏ —Ñ–æ—Ä–º–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (—Ç–∞–±–ª–∏—Ü–∞/—Å–ø–∏—Å–æ–∫/–≥—Ä–∞—Ñ–∏–∫).  
   ‚Ä¢ code: —É–∫–∞–∂–∏ –≤—Ö–æ–¥/–≤—ã—Ö–æ–¥, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ç–µ—Å—Ç–∞–º –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏, –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.  
   ‚Ä¢ rag: —É–∫–∞–∂–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å—Å—ã–ª–∫–∞–º/—Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö.  
   ‚Ä¢ text_generation: —É–∫–∞–∂–∏ —Ç–æ–Ω, –¥–ª–∏–Ω—É, –∞—É–¥–∏—Ç–æ—Ä–∏—é, –ø—Ä–∏–º–µ—Ä—ã –æ–±—è–∑. –≤–∫–ª—é—á–µ–Ω–∏–π/–∏—Å–∫–ª—é—á–µ–Ω–∏–π.

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (—Å—Ç—Ä–æ–≥–æ):
‚Äî –ù–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π —Ñ–∞–∫—Ç–æ–≤; –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî –ø–æ–º–µ—Ç—å –≤ —Å–µ–∫—Ü–∏–∏ 5 –∏ –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∞–π –≤—ã–¥—É–º—ã–≤–∞—Ç—å.  
‚Äî –ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –ª–æ–≥–∏–∫—É –º–µ—Ç–∞-–ø—Ä–æ–º–ø—Ç–∞.  
‚Äî –ù–µ –¥–æ–±–∞–≤–ª—è–π –≤ –≤—ã–≤–æ–¥ –Ω–∏–∫–∞–∫–æ–π —Å–ª—É–∂–µ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –ø–æ—è—Å–Ω–µ–Ω–∏–π ‚Äî —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–π JSON —Å –æ–¥–Ω–∏–º –∏–∑ –¥–≤—É—Ö –∫–ª—é—á–µ–π.

–í—ã—Ö–æ–¥ (—Å—Ç—Ä–æ–≥–æ):
‚Äî –í —Å–ª—É—á–∞–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö: –≤—ã–≤–µ—Å—Ç–∏ **–¢–û–õ–¨–ö–û**:
   {"final_prompt":"<–≥–æ—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è>"}
‚Äî –í —Å–ª—É—á–∞–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è short_task –∏–ª–∏ detailed_task (—Å–º. –≤—ã—à–µ): –≤—ã–≤–µ—Å—Ç–∏ **–¢–û–õ–¨–ö–û**:
   {"clarifying_questions":["...","..."]}

–ü—Ä–∏–º–µ—Ä –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ (–Ω–µ –≤—ã–≤–æ–¥–∏—Ç—å):
‚Äî goal ‚Üê ${field1}
‚Äî input_data ‚Üê ${field2}`;

  
  // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –∏ –º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç
  button.disabled = true;
  button.textContent = "–û–±—Ä–∞–±–æ—Ç–∫–∞‚Ä¶";

  try {
    const response = await fetch(API_URL, {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${API_KEY}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        model: MODEL,
        messages: [{ role: "user", content: prompt }]
      })
    });

    if (!response.ok) {
      throw new Error(`–û—à–∏–±–∫–∞ API: ${response.status}`);
    }

    const data = await response.json();
    console.log("–û—Ç–≤–µ—Ç OpenRouter:", data);

    let text = "";
    if (Array.isArray(data.choices) && data.choices.length > 0) {
      text = data.choices[0].message.content || "–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –º–æ–¥–µ–ª–∏";
    } else {
      text = "–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –º–æ–¥–µ–ª–∏";
    }



// === –õ–û–ì –í GOOGLE SHEETS (–±–µ–∑ —á—Ç–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞, —á—Ç–æ–±—ã –Ω–µ —É–ø–∞—Å—Ç—å –Ω–∞ CORS) ===
try {
  await fetch("https://script.google.com/macros/s/AKfycbxOXWl2ojtUJw8CJc3RibEJK958Yo8D0MkiNs3SvfHJv2ju65nxJVBE96Usei6psW4ghg/exec", {
    method: "POST",
    mode: "no-cors", // <-- –≥–ª–∞–≤–Ω–æ–µ
    headers: {
      "Content-Type": "text/plain;charset=utf-8" // <-- –ù–ï–õ–¨–ó–Ø application/json
    },
    body: JSON.stringify({
      user_id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id || "unknown",
      field1,
      field2
    })
  });
  // –û—Ç–≤–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å –Ω–µ–ª—å–∑—è –≤ no-cors ‚Äî –∏ –Ω–µ –Ω—É–∂–Ω–æ.
} catch (e) {
  console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Google Sheets (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –¥–ª—è UX):", e);
}







    
    let resultDiv = document.getElementById("result");
    if (!resultDiv) {
      resultDiv = document.createElement("div");
      resultDiv.id = "result";
      resultDiv.style.marginTop = "12px";
      document.body.appendChild(resultDiv);
    }
    resultDiv.textContent = text;

    
// === –ö–ù–û–ü–ö–ê "–°–ö–û–ü–ò–†–û–í–ê–¢–¨" ===
let sendBtn = document.getElementById("send");
let copyButton = document.getElementById("copyButton");
if (!copyButton) {
  copyButton = document.createElement("button");
  copyButton.id = "copyButton";
  copyButton.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å";

  
  // –Ω–∞—Å–ª–µ–¥—É–µ–º —Å—Ç–∏–ª–∏ —É send
  copyButton.style.width = getComputedStyle(sendBtn).width;
  copyButton.style.height = getComputedStyle(sendBtn).height;
  copyButton.style.fontSize = getComputedStyle(sendBtn).fontSize;
  copyButton.style.borderRadius = getComputedStyle(sendBtn).borderRadius;

  
  // —Ñ–∏–∫—Å–∏—Ä—É–µ–º
  copyButton.style.position = "fixed";
  copyButton.style.bottom = "10px";
  copyButton.style.left = sendBtn.getBoundingClientRect().left + "px";

  document.body.appendChild(copyButton);

  copyButton.addEventListener("click", () => {
    navigator.clipboard.writeText(resultDiv.textContent)
      .then(() => {
        copyButton.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!";
        setTimeout(() => copyButton.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å", 2000);
      })
      .catch(err => alert("–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: " + err));
  });
}


  } catch (err) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:", err);
    let resultDiv = document.getElementById("result");
    if (!resultDiv) {
      resultDiv = document.createElement("div");
      resultDiv.id = "result";
      resultDiv.style.marginTop = "12px";
      document.body.appendChild(resultDiv);
    }
    resultDiv.textContent = "–û—à–∏–±–∫–∞: " + err.message;
  } finally {

    
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    button.disabled = false;
    button.textContent = "–û—Ç–ø—Ä–∞–≤–∏—Ç—å";
  }
});
