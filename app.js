// --- –¢–µ–ª–µ–≥—Ä–∞–º –¥–∞–Ω–Ω—ã–µ ---
const tg = window.Telegram.WebApp;
const user = tg.initDataUnsafe?.user;

if (user) {
  const photo = document.getElementById("user-photo");
  const greeting = document.getElementById("user-greeting");
  const nameBlock = document.getElementById("user-name");

  if (user.photo_url) {
    photo.src = user.photo_url;
  } else {
    photo.style.display = "none";
  }

  greeting.textContent = `–ü—Ä–∏–≤–µ—Ç, ${user.first_name || user.username || "–≥–æ—Å—Ç—å"}! üëã`;
  nameBlock.textContent = user.username ? `@${user.username}` : "";
}


// === –û–¢–ü–†–ê–í–ö–ê –î–ê–ù–ù–´–• ===
document.getElementById("send").addEventListener("click", async () => {
  const button = document.getElementById("send");
  const field1 = document.getElementById("field1").value;
  const field2 = document.getElementById("field2").value;

  if (!field1 && !field2) {
    alert("–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ!");
    return;
  }

  const prompt = `–¢—ã ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∞–±—Ä–∏–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤. –í—Ö–æ–¥ ‚Äî —Ä–æ–≤–Ω–æ –¥–≤–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
  ${field1}    <-- –∫—Ä–∞—Ç–∫–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏ –ø—Ä–æ–º–ø—Ç–∞
  ${field2}    <-- —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–µ –ø–æ—è—Å–Ω–µ–Ω–∏–µ / –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

–ó–∞–¥–∞—á–∞: –ù–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–∏—Ö –¥–≤—É—Ö —Å—Ç—Ä–æ–∫ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∏ –≤–µ—Ä–Ω—É—Ç—å –û–î–ò–ù –≥–æ—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –≤ –≤–∏–¥–µ –í–ê–õ–ò–î–ù–û–ì–û JSON —Å –ø–æ–ª—è–º–∏ –≤ –ø–æ—Ä—è–¥–∫–µ: Role, Context, Task, Constraints, Format.  
–í—ã–≤–æ–¥–∏ –¢–û–õ–¨–ö–û JSON ‚Äî –Ω–∏–∫–∞–∫–∏—Ö –ø–æ—è—Å–Ω–µ–Ω–∏–π –∏–ª–∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –º—ã—Å–ª–µ–π.

–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º (–≤—ã–ø–æ–ª–Ω—è–π —Å–∫—Ä—ã—Ç–æ, –Ω–æ –æ—Ç—Ä–∞–∑–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Constraints):
1) –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è: –∏–∑–≤–ª–µ–∫–∏ –∏–∑ –≤—Ö–æ–¥–∞ —Ü–µ–ª—å, —Ü–µ–ª–µ–≤—É—é –∞—É–¥–∏—Ç–æ—Ä–∏—é, —Ç—Ä–µ–±—É–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, —Ç–æ–Ω, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã; –µ—Å–ª–∏ —è–≤–Ω–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ ‚Äî —Å–¥–µ–ª–∞–π —Ä–∞–∑—É–º–Ω—ã–µ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–π –∏—Ö –≤ Constraints –∫–∞–∫ "assumptions"; –µ—Å–ª–∏ –æ–¥–Ω–æ –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–ª–µ–π –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å ‚Äî –æ—Å—Ç–∞–≤—å –≤ —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–º –ø—Ä–æ–º–ø—Ç–µ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä [–£–ö–ê–ñ–ò–¢–ï: <—á—Ç–æ>].
2) –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (LPW): —Å–æ—Å—Ç–∞–≤—å –∫—Ä–∞—Ç–∫–∏–π –ø–ª–∞–Ω –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–∞ (—à–∞–≥–∏: —Ä–∞–∑–±–∏—Ç—å –∑–∞–¥–∞—á—É ‚Üí —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã ‚Üí –æ—Ü–µ–Ω–∏—Ç—å ‚Üí —Ä–µ—Ñ–∞–π–Ω ‚Üí —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è).
3) –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π 5 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ (Best-of-N). –ö–∞–∂–¥—ã–π –∫–∞–Ω–¥–∏–¥–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º —Å –ø–æ–ª–µ–º Format (–≤–∫–ª—é—á–∞—Ç—å —à–∞–±–ª–æ–Ω —Å–µ–∫—Ü–∏–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è). –ù–µ –≤—ã–≤–æ–¥–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã ‚Äî –¥–µ—Ä–∂–∏ –∏—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ.
4) –û—Ü–µ–Ω–∏ –∫–∞–∂–¥—ã–π –∫–∞–Ω–¥–∏–¥–∞—Ç –ø–æ HPSS: –≤—ã—Å—Ç–∞–≤—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–∞–ª–ª—ã 1‚Äì10 –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º Clarity, Control, Coverage, Faithfulness, Testability; –ø–æ—Å—á–∏—Ç–∞–π total.
5) –†–∞–Ω–∂–∏—Ä—É–π –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –ø–æ total (RankCoT). –í Constraints –ø–µ—Ä–µ—á–∏—Å–ª–∏ –∫—Ä–∞—Ç–∫–æ –æ—Ü–µ–Ω–∫–∏ –∏ –ø—Ä–∏—á–∏–Ω—É –≤—ã–±–æ—Ä–∞ —Ç–æ–ø-1.
6) Self-refine: –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–æ 2 –∏—Ç–µ—Ä–∞—Ü–∏–π –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è —Ç–æ–ø-1 (—É–ø—Ä–æ—Å—Ç–∏ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏, —É—Ç–æ—á–Ω–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –¥–æ–±–∞–≤—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è); –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–æ—Ü–µ–Ω–∏—Ç–µ –ø–æ HPSS; –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–Ω–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é.
7) RAG-—Ä–µ—à–µ–Ω–∏–µ: –µ—Å–ª–∏ –≤—Ö–æ–¥ —è–≤–Ω–æ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–∫—Ç–æ–≤ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏, —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π –≤ Constraints –ø–ª–∞–Ω –ø–æ–∏—Å–∫–∞ (—á—Ç–æ –∏—Å–∫–∞—Ç—å, –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –≥–¥–µ –≤—Å—Ç–∞–≤–ª—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –ø—Ä–∞–≤–∏–ª–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤) –∏ –≤—Å—Ç—Ä–æ–∏ –≤ –∏—Ç–æ–≥–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –∫—Ä–∞—Ç–∫—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è RAG. –ò–Ω–∞—á–µ ‚Äî –Ω–µ –¥–æ–±–∞–≤–ª—è–π RAG.
8) –ê–Ω—Å–∞–º–±–ª–µ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –∏—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∞–≤–∏–ª–æ "2‚Äì3 —Å–ª–∞–±—ã—Ö –æ—Ü–µ–Ω—â–∏–∫–∞" (—Å–º. Constraints) –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è, —á—Ç–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å—Ç–∞–±–∏–ª–µ–Ω (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤).
9) –ò—Ç–æ–≥: –ø–æ–¥–≥–æ—Ç–æ–≤—å –æ–¥–∏–Ω JSON-–æ–±—ä–µ–∫—Ç —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ (—Å–º. –Ω–∏–∂–µ). –í –ø–æ–ª–µ Constraints —É–∫–∞–∂–∏, –∫–∞–∫–∏–µ —à–∞–≥–∏ –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –∏ –∫—Ä–∞—Ç–∫–∏–µ HPSS-—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã; –≤ –ø–æ–ª–µ Format –ø–æ–º–µ—Å—Ç–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ (–≤–∫–ª—é—á–∞—è –û–ü–ï–†–ê–¶–ò–û–ù–ê–õ–ò–ó–û–í–ê–ù–ù–û–ï –º—ã—à–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è ‚Äî —Å–º. —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –Ω–∏–∂–µ).

–°—Ç—Ä–æ–≥–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –≤—ã–≤–æ–¥–∞:
- –í—ã–¥–∞–≤–∞–π –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–π JSON —Å —Ç–æ—á–Ω—ã–º–∏ –ø–æ–ª—è–º–∏: Role, Context, Task, Constraints, Format.
- –ù–µ –≤—ã–≤–æ–¥–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ CoT/–ø–æ—à–∞–≥–æ–≤—ã–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è –∫–∞–∫ —Ç–µ–∫—Å—Ç ‚Äî –æ–Ω–∏ –¥–µ–ª–∞—é—Ç—Å—è —Å–∫—Ä—ã—Ç–æ; –æ—Ç—Ä–∞–∂–∞–π —Ç–æ–ª—å–∫–æ –∏—Ç–æ–≥–æ–≤—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.
- –í —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–º –ø—Ä–æ–º–ø—Ç–µ (–ø–æ–ª–µ Format) —è–≤–Ω–æ —É–∫–∞–∂–∏ placeholder [–£–ö–ê–ñ–ò–¢–ï: ...] –Ω–∞ –º–µ—Å—Ç–æ –ª—é–±—ã—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, [–£–ö–ê–ñ–ò–¢–ï: —Ü–µ–ª–µ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞]).
- –§–æ—Ä–º–∞—Ç –ø–æ–ª—è Format ‚Äî —ç—Ç–æ —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é-LLM; –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–º ‚Äî —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ä–æ–ª—å, –∑–∞–¥–∞—á—É, –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ –º—ã—à–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (–Ω–∏–∂–µ).

–¢—Ä–µ–±—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON-–≤—ã—Ö–æ–¥–∞ (–∑–∞–ø–æ–ª–Ω–∏ –∫–∞–∂–¥–æ–µ –ø–æ–ª–µ; —Å—Ç—Ä–æ–∫–∏ –≤ –∫–∞–≤—ã—á–∫–∞—Ö; –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç ‚Äî –≤—Å—Ç–∞–≤—å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä):

{
  "Role": "<–∫–æ—Ä–æ—Ç–∫–∞—è —Ä–æ–ª—å/–ø–µ—Ä—Å–æ–Ω–∞, –ø–æ–¥—Ö–æ–¥—è—â–∞—è –¥–ª—è –∑–∞–¥–∞—á–∏, –∏–∑–≤–ª–µ—á—ë–Ω–Ω–∞—è –∏–ª–∏ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–Ω–∞—è>",
  "Context": "<–∫–æ–Ω–∫—Ä–µ—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç: –∞—É–¥–∏—Ç–æ—Ä–∏—è, —Ç–æ–Ω, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ; –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ [–£–ö–ê–ñ–ò–¢–ï: ...] –≥–¥–µ –Ω—É–∂–Ω–æ>",
  "Task": "<—á—ë—Ç–∫–æ–µ –∫—Ä–∞—Ç–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞ –≤—Ö–æ–¥–µ>",
  "Constraints": "<–æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∞–º–∫–∏ ‚Äî –æ—Ç—á—ë—Ç –æ —Ä–∞–±–æ—Ç–µ –º–µ—Ç–∞-–ø—Ä–æ–º–ø—Ç–∞ (–º–∞—à–∏–Ω–Ω–æ-—á–∏—Ç–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç): 
     —É–∫–∞–∂–∏: 'assumptions' (–µ—Å–ª–∏ –¥–µ–ª–∞–ª–∏—Å—å –¥–æ–ø—É—â–µ–Ω–∏—è), –∫—Ä–∞—Ç–∫–∏–π –ø–ª–∞–Ω (SR-FoT style: —Ü–µ–ª—å ‚Üí –ø—Ä–µ–¥–ø–æ—Å—ã–ª–∫–∏ ‚Üí –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç), 
     —á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ: '—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ 5 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤; –æ—Ü–µ–Ω–∫–∏ HPSS: [{id, Clarity, Control, Coverage, Faithfulness, Testability, total},...]; –≤—ã–±—Ä–∞–Ω –∫–∞–Ω–¥–∏–¥–∞—Ç id=X; self-refine –∏—Ç–µ—Ä–∞—Ü–∏–π=Y (–∏ –∫—Ä–∞—Ç–∫–æ —á—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)'; 
     –µ—Å–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω RAG-–ø–ª–∞–Ω ‚Äî –æ–ø–∏—à–∏ –µ–≥–æ –∫–æ—Ä–æ—Ç–∫–æ; 
     –µ—Å–ª–∏ –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã ‚Äî –ø–µ—Ä–µ—á–∏—Å–ª–∏ –∫–∞–∫–∏–µ –∏ –ø–æ—á–µ–º—É.>",
  "Format": "<–¢–µ–∫—Å—Ç —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è ‚Äî –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ –û–ü–ï–†–ê–¶–ò–û–ù–ù–´–ï —Å–µ–∫—Ü–∏–∏ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—Å—Ç–∞–≤–ª—è—é—Ç LLM –¥—É–º–∞—Ç—å (–Ω–µ –ø—Ä–æ—Å—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏—è, –∞ —Ç–æ—á–Ω—ã–µ —É–∫–∞–∑–∞–Ω–∏—è): 

     --- –Ω–∞—á–∞–ª–æ —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ (–∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é LLM) ---
     –†–æ–ª—å: [—É–∫–∞–∑–∞—Ç—å —Ä–æ–ª—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è; –µ—Å–ª–∏ –Ω–µ –∏–∑–≤–µ—Å—Ç–Ω–æ, –≤—Å—Ç–∞–≤—å '[–£–ö–ê–ñ–ò–¢–ï: —Ä–æ–ª—å]'].
     –ó–∞–¥–∞—á–∞: [–∫–æ—Ä–æ—Ç–∫–∞—è —Ü–µ–ª—å ‚Äî –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∏–∑ Task].

     –ö–æ–Ω—Ç–µ–∫—Å—Ç: [–≤—Å—Ç–∞–≤–∏—Ç—å Context; –µ—Å–ª–∏ –∫–∞–∫–∏–µ-—Ç–æ —ç–ª–µ–º–µ–Ω—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç ‚Äî —Å—Ç–∞–≤—å '[–£–ö–ê–ñ–ò–¢–ï: ...]'].

     –í–ê–ñ–ù–û: –í—ã–ø–æ–ª–Ω—è–π –∑–∞–¥–∞—á—É —Å—Ç—Ä–æ–≥–æ –ø–æ —Å–µ–∫—Ü–∏—è–º –Ω–∏–∂–µ –∏ –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–π –∏—Ö. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ—è—Å–Ω–æ ‚Äî —Å–¥–µ–ª–∞–π —Ä–∞–∑—É–º–Ω—ã–µ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è –∏ —è–≤–Ω–æ –æ—Ç–º–µ—Ç—å –∏—Ö –≤ —Ä–∞–∑–¥–µ–ª–µ '–ü–æ–Ω–∏–º–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ / –î–æ–ø—É—â–µ–Ω–∏—è'.

     1) –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∏ –¥–æ–ø—É—â–µ–Ω–∏—è (Description): 2‚Äì3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ‚Äî –∫—Ä–∞—Ç–∫–æ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π, –∫–∞–∫ —Ç—ã –ø–æ–Ω—è–ª —Ü–µ–ª—å, –∞—É–¥–∏—Ç–æ—Ä–∏—é, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è; –µ—Å–ª–∏ —Å–¥–µ–ª–∞–ª –¥–æ–ø—É—â–µ–Ω–∏—è ‚Äî –ø–µ—Ä–µ—á–∏—Å–ª–∏ –∏—Ö.
     2) –®–∞–≥–∏ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è (Chain-of-Thought, –ø—Ä–µ–¥—ä—è–≤–ª—è–µ–º–∞—è —Ñ–æ—Ä–º–∞): –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —à–∞–≥–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –≤—ã–ø–æ–ª–Ω—è–µ—à—å –¥–ª—è —Ä–µ—à–µ–Ω–∏—è (–∫–æ—Ä–æ—Ç–∫–æ, 3‚Äì8 –ø—É–Ω–∫—Ç–æ–≤). –≠—Ç–∏ —à–∞–≥–∏ –æ–±—è–∑–∞–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –≤—ã–≤–æ–¥—ã (–Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π CoT –ø–æ–¥—Ä–æ–±–Ω–æ, –Ω–æ —Ñ–∏–∫—Å–∏—Ä—É—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–µ—à–µ–Ω–∏—è).
     3) –†–µ—à–µ–Ω–∏–µ –ø–æ –ø–æ–¥–∑–∞–¥–∞—á–∞–º (Divide & Conquer): –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–¥–∑–∞–¥–∞—á–∏ ‚Äî –ø–æ–¥–ø—É–Ω–∫—Ç —Å –∫—Ä–∞—Ç–∫–∏–º –≤—ã–≤–æ–¥–æ–º/–∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–º.
     4) –û—Å–Ω–æ–≤–Ω–æ–π –æ—Ç–≤–µ—Ç (—Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç: —Ç–µ–∫—Å—Ç/–∫–æ–¥/–æ–ø–∏—Å–∞–Ω–∏–µ/–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —Ç.–ø.) ‚Äî –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∑–∞–¥–∞—á–µ–π.
     5) –ù–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç–∏ –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (Uncertainty handling): –ø–µ—Ä–µ—á–∏—Å–ª–∏, —á—Ç–æ –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–µ—è—Å–Ω—ã–º, –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ 1‚Äì3 –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–∞ –∏–ª–∏ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ (–≤–∞—Ä–∏–∞–Ω—Ç—ã).
     6) –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (Calibration): –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª—é—á–µ–≤–æ–≥–æ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–∫–∞–∂–∏ [–Ω–∏–∑–∫–∞—è/—Å—Ä–µ–¥–Ω—è—è/–≤—ã—Å–æ–∫–∞—è] –∏ –æ–¥–Ω—É-–¥–≤–µ –ø—Ä–∏—á–∏–Ω—ã.
     7) –°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (Self-verification): –∫—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏, –∫–∞–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—ã –≤—ã–ø–æ–ª–Ω–∏–ª –Ω–∞–¥ –æ—Ç–≤–µ—Ç–æ–º (–ª–æ–≥–∏–∫–∞, —Ñ–∞–∫—Ç—ã, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º) –∏ –≤–Ω–µ—Å—ë–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è; –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–µ—à–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Äî —É–∫–∞–∑–∞—Ç—å RAG-–ø–ª–∞–Ω (—á—Ç–æ –∏—Å–∫–∞—Ç—å, –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã).
     8) –í–∞—Ä–∏–∞–Ω—Ç—ã (Best-of-N –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è) ‚Äî –µ—Å–ª–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ: –ø—Ä–µ–¥–ª–æ–∂–∏ 2 –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö —Å—Ç–∏–ª—è/—Ç–æ–Ω–∞/—Ä–µ—à–µ–Ω–∏—è (–∫–æ—Ä–æ—Ç–∫–æ).
     
     --- –∫–æ–Ω–µ—Ü —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ ---
     
     –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –í —Ç–µ–∫—Å—Ç–µ —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —É–∫–∞–∑–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–≤ —à–∞–≥–µ 2 —Å—Ä–∞–≤–Ω–∏ A —Å B –∏ –≤—ã–±–µ—Ä–∏ –ª—É—á—à–∏–π –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—é X'), –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–µ—Ö–Ω–∏–∫. –ö–∞–∂–¥—É—é –ø—É—Å—Ç—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∑–∞–º–µ–Ω—è–π –Ω–∞ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã [–£–ö–ê–ñ–ò–¢–ï: ...]. 
  >"
}

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ JSON:
- –°—Ç—Ä–æ–≥–æ JSON (–¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏, —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ).  
- –ü–æ–ª–µ Constraints –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–º –æ—Ç—á—ë—Ç–æ–º (–¥–æ ~300 —Å–ª–æ–≤), –Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å HPSS-—Ç–∞–±–ª–∏—Ü—É –∏ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤/assumptions.  
- –ü–æ–ª–µ Format –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞ (–∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ), –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π.  
- –ù–∏–∫–∞–∫–∏—Ö –ª–∏—à–Ω–∏—Ö –ø–æ–ª–µ–π.

–¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–π –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ ${field1} –∏ ${field2}, –≤—ã–ø–æ–ª–Ω–∏ –æ–ø–∏—Å–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∏ –≤–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ JSON.
`;

  
  // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –∏ –º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç
  button.disabled = true;
  button.textContent = "–û–±—Ä–∞–±–æ—Ç–∫–∞‚Ä¶";

  try {
    const response = await fetch(API_URL, {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${API_KEY}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        model: MODEL,
        messages: [{ role: "user", content: prompt }]
      })
    });

    if (!response.ok) {
      throw new Error(`–û—à–∏–±–∫–∞ API: ${response.status}`);
    }

    const data = await response.json();
    console.log("–û—Ç–≤–µ—Ç OpenRouter:", data);

    let text = "";
    if (Array.isArray(data.choices) && data.choices.length > 0) {
      text = data.choices[0].message.content || "–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –º–æ–¥–µ–ª–∏";
    } else {
      text = "–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –º–æ–¥–µ–ª–∏";
    }



// === –õ–û–ì –í GOOGLE SHEETS (–±–µ–∑ —á—Ç–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞, —á—Ç–æ–±—ã –Ω–µ —É–ø–∞—Å—Ç—å –Ω–∞ CORS) ===
try {
  await fetch("https://script.google.com/macros/s/AKfycbxOXWl2ojtUJw8CJc3RibEJK958Yo8D0MkiNs3SvfHJv2ju65nxJVBE96Usei6psW4ghg/exec", {
    method: "POST",
    mode: "no-cors", // <-- –≥–ª–∞–≤–Ω–æ–µ
    headers: {
      "Content-Type": "text/plain;charset=utf-8" // <-- –ù–ï–õ–¨–ó–Ø application/json
    },
    body: JSON.stringify({
      user_id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id || "unknown",
      field1,
      field2
    })
  });
  // –û—Ç–≤–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å –Ω–µ–ª—å–∑—è –≤ no-cors ‚Äî –∏ –Ω–µ –Ω—É–∂–Ω–æ.
} catch (e) {
  console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Google Sheets (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –¥–ª—è UX):", e);
}







    
    let resultDiv = document.getElementById("result");
    if (!resultDiv) {
      resultDiv = document.createElement("div");
      resultDiv.id = "result";
      resultDiv.style.marginTop = "12px";
      document.body.appendChild(resultDiv);
    }
    resultDiv.textContent = text;

    
// === –ö–ù–û–ü–ö–ê "–°–ö–û–ü–ò–†–û–í–ê–¢–¨" ===
let sendBtn = document.getElementById("send");
let copyButton = document.getElementById("copyButton");
if (!copyButton) {
  copyButton = document.createElement("button");
  copyButton.id = "copyButton";
  copyButton.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å";

  
  // –Ω–∞—Å–ª–µ–¥—É–µ–º —Å—Ç–∏–ª–∏ —É send
  copyButton.style.width = getComputedStyle(sendBtn).width;
  copyButton.style.height = getComputedStyle(sendBtn).height;
  copyButton.style.fontSize = getComputedStyle(sendBtn).fontSize;
  copyButton.style.borderRadius = getComputedStyle(sendBtn).borderRadius;

  
  // —Ñ–∏–∫—Å–∏—Ä—É–µ–º
  copyButton.style.position = "fixed";
  copyButton.style.bottom = "10px";
  copyButton.style.left = sendBtn.getBoundingClientRect().left + "px";

  document.body.appendChild(copyButton);

  copyButton.addEventListener("click", () => {
    navigator.clipboard.writeText(resultDiv.textContent)
      .then(() => {
        copyButton.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!";
        setTimeout(() => copyButton.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å", 2000);
      })
      .catch(err => alert("–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: " + err));
  });
}


  } catch (err) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:", err);
    let resultDiv = document.getElementById("result");
    if (!resultDiv) {
      resultDiv = document.createElement("div");
      resultDiv.id = "result";
      resultDiv.style.marginTop = "12px";
      document.body.appendChild(resultDiv);
    }
    resultDiv.textContent = "–û—à–∏–±–∫–∞: " + err.message;
  } finally {

    
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    button.disabled = false;
    button.textContent = "–û—Ç–ø—Ä–∞–≤–∏—Ç—å";
  }
});
